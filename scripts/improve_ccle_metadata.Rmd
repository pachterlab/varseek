---
title: "depmap"
output: html_document
date: "2024-11-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Install the depmap package if you haven't already
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("depmap")

# Load the depmap library
library(depmap)
library(dplyr)
library(jsonlite)
```

```{r}
# Retrieve the cell line metadata
metadata <- depmap_metadata()

# Load the JSON file as a list
json_data <- fromJSON("/Users/joeyrich/Downloads/ccle_metadata.json", simplifyDataFrame = TRUE)

# Convert to a data frame for easier manipulation if necessary
json_df <- as.data.frame(json_data)
```

```{r}
# ben_lung_data <- metadata %>% filter(cell_line == "BEN_LUNG")
# ben_lung_data %>% select(primary_disease, subtype_disease)

# Placeholder for storing results
results <- list()

# Loop through each row in the JSON data
for (i in 1:nrow(json_df)) {
  # Extract the sample_title
  sample_title <- json_df$sample_title[i]
  
  # Filter the DepMap metadata for the given cell line
  sample_data <- metadata %>% filter(cell_line == sample_title)
  
  # Extract primary_disease and subtype_disease
  disease_info <- sample_data %>% select(primary_disease, subtype_disease, sex, age, lineage, lineage_subtype, Cellosaurus_NCIt_disease)
  
  # Add to the row in the JSON data
  json_df$primary_disease[i] <- disease_info$primary_disease[1]
  json_df$subtype_disease[i] <- disease_info$subtype_disease[1]
  json_df$sex[i] <- disease_info$sex[1]
  json_df$age[i] <- disease_info$age[1]
  json_df$lineage[i] <- disease_info$lineage[1]
  json_df$lineage_subtype[i] <- disease_info$lineage_subtype[1]
  json_df$Cellosaurus_NCIt_disease[i] <- disease_info$Cellosaurus_NCIt_disease[1]
}
```

```{r}
# Convert the updated data frame back to JSON
updated_json <- toJSON(json_df, pretty = TRUE, auto_unbox = TRUE)

# Save the updated JSON to a file
write(updated_json, "/Users/joeyrich/Downloads/ccle_metadata_updated.json")
```